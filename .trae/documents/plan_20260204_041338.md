# 重构Flask博客项目架构

## 问题分析

当前项目存在架构混乱问题：

* **后端（5000端口）**：完整的Flask模板系统，包含独立的博客主页

* **前端（3000端口）**：完整的React应用，也包含独立的博客主页

* 两个端口都有独立的博客功能，导致内容不一致和用户混淆

## 重构目标

1. **统一架构**：采用前后端分离架构，后端专注于API服务，前端负责UI渲染
2. **消除重复**：移除后端模板系统的博客功能，保留API功能
3. **数据同步**：前端从后端API获取真实数据，替代模拟数据
4. **简化部署**：构建前端静态文件，由Flask提供静态文件服务

## 重构方案

### 1. 后端重构

**步骤1：改造后端为API服务**

* 修改 `app.py`：移除模板渲染路由（`/`, `/post/<filename>`, `/tags`, `/tag/<tag>`, `/archive`, `/about`）

* 添加API路由：`/api/posts`, `/api/posts/<id>`, `/api/tags`, `/api/archive`, `/api/about`

* 保持管理后台路由不变（`/admin/*`）

* 保持RSS和Sitemap功能不变

**步骤2：优化数据模型**

* 统一数据格式，确保API返回标准化的JSON结构

* 修复 `get_posts()` 函数，确保与API返回格式一致

* 优化 `feed()` 函数，修复重复代码

### 2. 前端重构

**步骤1：集成后端API**

* 修改 `src/pages/Home.tsx`：使用真实API数据替代模拟数据

* 修改 `src/pages/Admin.tsx`：集成后端管理API

* 添加API服务层：创建 `src/services/api.ts` 处理API调用

**步骤2：优化前端路由**

* 保持前端路由结构不变

* 确保前端路由与后端API路由对应

### 3. 部署配置

**步骤1：构建前端**

* 在 `frontend` 目录执行 `npm run build`

* 将构建产物复制到 `static` 目录

**步骤2：配置Flask静态文件服务**

* 修改 `app.py`：添加静态文件路由，指向构建后的前端文件

* 添加 `@app.route('/<path:path>')` 路由，处理前端路由刷新问题

**步骤3：测试部署**

* 启动Flask应用：`python app.py`

* 访问 `http://localhost:5000` 验证前端页面

* 访问 `http://localhost:5000/admin` 验证后台管理

## 预期效果

* **单一入口**：用户只需要访问5000端口，看到统一的博客界面

* **数据一致**：前端显示的是后端真实数据

* **架构清晰**：后端专注于API，前端专注于UI

* **部署简单**：单一Flask应用，包含所有功能

## 技术栈保持不变

* **后端**：Flask, SQLAlchemy, Flask-Migrate

* **前端**：React, TypeScript, Framer Motion, Sass

* **数据存储**：SQLite

## 重构顺序

1. 后端API改造
2. 前端API集成
3. 前端构建与部署配置
4. 测试与优化

